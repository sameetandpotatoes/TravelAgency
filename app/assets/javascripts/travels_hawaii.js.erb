<% current_dest = 'Hawaii' %>
var dest_1 = "<%= INFO[current_dest]['cities'][0]['name'].downcase.gsub(/\s+/, '') %>";
var dest_2 = "<%= INFO[current_dest]['cities'][1]['name'].downcase.gsub(/\s+/, '') %>";
var dest_3 = "<%= INFO[current_dest]['cities'][2]['name'].downcase.gsub(/\s+/, '') %>";
var map;

var coords = [<%= INFO[current_dest]['cities'][0]['location'] %>, <%= INFO[current_dest]['cities'][1]['location'] %>, <%= INFO[current_dest]['cities'][2]['location'] %>];
var titles = ["<%= INFO[current_dest]['cities'][0]['name'] %>", "<%= INFO[current_dest]['cities'][1]['name'] %>", "<%= INFO[current_dest]['cities'][2]['name'] %>"];
var desc = ['desc-1', 'desc-2', 'desc-3'];
var colors = ['#f86767','#f86767','#f86767'];

function initialize_map(){
	L.mapbox.accessToken = "<%= ENV['MAPBOX_ACCESS'] %>";
	map = L.mapbox.map('hawaii-map', "<%= ENV['MAPBOX_MAP'] %>");
	map.setView(<%= INFO[current_dest]['location'] %>, 7);
	// map.dragging.disable();
	map.touchZoom.disable();
	map.doubleClickZoom.disable();
	map.scrollWheelZoom.disable();
	if (map.tap) map.tap.disable();
}

function overlay_markers(){
	for (var i = 0; i < 3; i++){
		L.mapbox.featureLayer({
			type: 'Feature',
			geometry: {
				type: 'Point',
				coordinates: coords[i]
			},
			properties: {
				title: titles[i],
				dest: desc[i],
				'marker-color': colors[i]
			}
		}).addTo(map).on('click', mapClickHandler);
	}
}

function mapClickHandler(e){
	// //Makes it so that only one can be flipped currently
	// $('.flipper').removeClass("flipped");

	//Toggle
	if ($('.flip-container.'+e.layer.feature.properties['dest'] + ' .flipper').hasClass("flip")){
		$('.flip-container.'+e.layer.feature.properties['dest'] + ' .flipper').removeClass('flip');
	} else{
		$('.flip-container.'+e.layer.feature.properties['dest'] + ' .flipper').addClass('flip');
	}
}

initialize_map();
overlay_markers();
