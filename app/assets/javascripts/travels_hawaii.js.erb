<% current_dest = 'Hawaii' %>
var dest_1 = "<%= INFO[current_dest]['cities'][0]['name'].downcase.gsub(/\s+/, '') %>";
var dest_2 = "<%= INFO[current_dest]['cities'][1]['name'].downcase.gsub(/\s+/, '') %>";
var dest_3 = "<%= INFO[current_dest]['cities'][2]['name'].downcase.gsub(/\s+/, '') %>";
var map;
var myLayer;
var coords = [<%= INFO[current_dest]['cities'][0]['location'] %>, <%= INFO[current_dest]['cities'][1]['location'] %>, <%= INFO[current_dest]['cities'][2]['location'] %>];
var titles = ["<%= INFO[current_dest]['cities'][0]['name'] %>", "<%= INFO[current_dest]['cities'][1]['name'] %>", "<%= INFO[current_dest]['cities'][2]['name'] %>"];
var desc = ['desc-1', 'desc-2', 'desc-3'];
var colors = ['#f86767','#f86767','#f86767'];

function initialize_map(){
	L.mapbox.accessToken = "<%= ENV['MAPBOX_ACCESS'] %>";
	map = L.mapbox.map('hawaii-map', "<%= ENV['MAPBOX_MAP'] %>");
	map.setView(<%= INFO[current_dest]['location'] %>, 7);
	map.dragging.disable();
	map.touchZoom.disable();
	map.doubleClickZoom.disable();
	map.scrollWheelZoom.disable();
	if (map.tap) map.tap.disable();
	myLayer = L.mapbox.featureLayer().addTo(map);
}

function overlay_markers(){
	var features = [];
	for (var i = 0; i < 3; i++){
		var hash = {
			type: 'Feature',
			properties: {
				title: titles[i],
				'marker-color': colors[i],
				'marker-size': 'large',
				'marker-symbol': 'star',
				dest: desc[i]
			},
			geometry: {
				type: 'Point',
				coordinates: coords[i]
			}
		};
		features.push(hash);
	}
	var geojson = {
		type: 'FeatureCollection',
		features: features
	};
	myLayer.setGeoJSON(geojson);
	myLayer.on('mouseover', function(e) {
		e.layer.openPopup();
		mapClickHandler(e);
	});
	myLayer.on('mouseout', function(e) {
		e.layer.closePopup();
		mapClickHandler(e);
	});
}

function mapClickHandler(e){
	$('.flip-container.'+e.layer.feature.properties['dest'] + ' .flipper').toggleClass("flip");
}

initialize_map();
overlay_markers();
